{
  "files_to_modify": {
    "backend": [
      "apps/backend/services/recovery.py",
      "apps/backend/agents/coder.py",
      "apps/backend/agents/session.py"
    ]
  },
  "files_to_create": {
    "backend": [
      "apps/backend/services/recovery_config.py",
      "apps/backend/services/recovery_strategies.py",
      "apps/backend/services/recovery_learner.py",
      "apps/backend/services/pattern_detector.py"
    ],
    "tests": [
      "tests/test_recovery_strategies.py",
      "tests/test_pattern_detector.py",
      "tests/test_recovery_learner.py"
    ]
  },
  "files_to_reference": [
    "apps/backend/services/recovery.py",
    "apps/backend/agents/coder.py",
    "apps/backend/agents/session.py",
    "apps/backend/integrations/graphiti/memory.py"
  ],
  "patterns": {
    "recovery_pattern": "RecoveryManager uses JSON files in spec_dir/memory/ for persistence",
    "dataclass_pattern": "Use @dataclass for structured results with type hints",
    "enum_pattern": "Use Enum classes for failure types and actions",
    "persistence": "State persists in spec_dir/memory/ as JSON files"
  },
  "existing_implementations": {
    "description": "Found existing RecoveryManager in services/recovery.py with attempt tracking, failure classification, and basic retry logic. Currently detects circular fixes and marks subtasks stuck after 3 attempts.",
    "relevant_files": [
      "apps/backend/services/recovery.py",
      "apps/backend/agents/coder.py",
      "apps/backend/agents/session.py"
    ],
    "what_exists": [
      "RecoveryManager class with attempt history tracking",
      "Failure type classification (BROKEN_BUILD, VERIFICATION_FAILED, CIRCULAR_FIX, CONTEXT_EXHAUSTED)",
      "Basic circular fix detection via keyword similarity",
      "Stuck subtask detection after 3 attempts",
      "Recovery hints generation for retry attempts",
      "Integration with Linear/Jira for notifications"
    ],
    "what_missing": [
      "Advanced pattern detection (infinite loops, thrashing)",
      "Automatic strategy switching with predefined alternatives",
      "Persistent learning from successful recoveries",
      "Configurable retry limits and timeouts"
    ]
  },
  "technology_decisions": {
    "storage": "JSON files in spec_dir/memory/ for pattern database and learnings",
    "strategy_system": "Strategy registry with fallback chain",
    "learning_approach": "Record successful recovery patterns and suggest them for similar failures"
  }
}
